---
interface Props {
  currentPage?: string;
  title?: string;
  subtitle?: string;
  showGoBack?: boolean;
}

const { currentPage, title = "John Jeong", subtitle = 'Co-founder & Co-CEO at <a href="https://hyprnote.com" target="_blank" rel="noopener" class="hyprnote-link">Hyprnote</a>', showGoBack = false } = Astro.props;

const navItems = [
  { href: "/", label: "About", key: "home" },
  { href: "/essays/en", label: "Essays", key: "essays" },
  { href: "/journals", label: "Daily Logs", key: "journals" },
  { href: "/inspirations", label: "Inspirations", key: "inspirations" },
  { href: "/lessons", label: "Lessons", key: "lessons" },
  { href: "/gallery", label: "Gallery", key: "gallery" },
];
---

<header>
  <h1>
    {currentPage ? (
      Astro.slots.has('title-extra') ? <slot name="title-extra" /> : title
    ) : (
      <a href="/">{title}</a>
    )}
  </h1>
  <p class="subtitle" data-full-text={subtitle}>
    <span class="subtitle-text" set:html={subtitle} />
    <button class="see-more" aria-label="Expand subtitle">see more</button>
  </p>
</header>

<div class="nav-container">
  <nav class:list={["main-nav", { "has-go-back": showGoBack }]}>
    {navItems.map((item) => (
      <div class="nav-item">
        <a href={item.href} class:list={[{ active: currentPage === item.key }]}>{item.label}</a>
        {showGoBack && currentPage === item.key && (
          <span class="go-back">Go back?</span>
        )}
      </div>
    ))}
  </nav>
</div>

<style is:global>
  header {
    margin-bottom: 1rem;
  }

  header h1 {
    margin-top: 0;
  }
  header h1 a {
    text-decoration: none;
  }
  .subtitle {
    color: #666;
    position: relative;
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
  }
  .subtitle .subtitle-text {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    flex: 1;
    min-width: 0;
  }
  .subtitle.expanded .subtitle-text {
    display: block;
    -webkit-line-clamp: unset;
  }
  .subtitle .see-more {
    display: none;
    background: none;
    border: none;
    color: #999;
    font-size: 0.85em;
    cursor: pointer;
    padding: 0;
    text-decoration: underline;
    font-family: inherit;
    flex-shrink: 0;
  }
  .subtitle.needs-truncation .see-more {
    display: inline;
  }
  .subtitle .see-more:hover {
    color: #666;
  }
  .hyprnote-link {
    font-family: var(--font-serif);
    text-decoration: none;
  }
  .hyprnote-link:hover {
    text-decoration: underline;
    text-decoration-style: dotted;
  }
  .nav-container {
    position: relative;
    margin-bottom: 0.5rem;
  }
  .nav-container::before,
  .nav-container::after {
    content: '';
    position: absolute;
    top: 0;
    height: 1.5rem;
    width: 2rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 1;
  }
  .nav-container::before {
    left: 0;
    background: linear-gradient(to right, #fff 0%, transparent 100%);
  }
  .nav-container::after {
    right: 0;
    background: linear-gradient(to left, #fff 0%, transparent 100%);
  }
  .nav-container.scroll-left::before {
    opacity: 1;
  }
  .nav-container.scroll-right::after {
    opacity: 1;
  }
  .main-nav {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 1.5rem;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .main-nav::-webkit-scrollbar {
    display: none;
  }
  .nav-item a {
    text-decoration: none;
    color: #666;
    padding-bottom: 0.25rem;
    font-family: var(--font-mono);
    font-size: 0.8rem;
  }
  .nav-item a:hover {
    color: #1a1a1a;
  }
  .nav-item a.active {
    color: #1a1a1a !important;
    border-bottom: 2px solid #1a1a1a !important;
  }
  .nav-item {
    position: relative;
    flex-shrink: 0;
  }
  .go-back {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-sans);
    font-size: 0.65rem;
    color: #666;
    opacity: 0.5;
    white-space: nowrap;
    margin-top: 0.25rem;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Subtitle expand/collapse
    const subtitle = document.querySelector('.subtitle');
    const subtitleText = subtitle?.querySelector('.subtitle-text') as HTMLElement | null;
    const seeMoreBtn = subtitle?.querySelector('.see-more');

    if (subtitle && subtitleText && seeMoreBtn) {
      const checkOverflow = () => {
        return subtitleText.scrollHeight > subtitleText.clientHeight;
      };

      if (checkOverflow()) {
        subtitle.classList.add('needs-truncation');
      }

      seeMoreBtn.addEventListener('click', () => {
        if (!subtitle.classList.contains('expanded')) {
          subtitle.classList.add('expanded');
          seeMoreBtn.textContent = 'see less';
        } else {
          subtitle.classList.remove('expanded');
          seeMoreBtn.textContent = 'see more';
        }
      });
    }

    // Nav scroll fade indicators
    const navContainer = document.querySelector('.nav-container');
    const nav = document.querySelector('.main-nav');

    if (navContainer && nav) {
      const updateScrollIndicators = () => {
        const scrollLeft = nav.scrollLeft;
        const maxScroll = nav.scrollWidth - nav.clientWidth;

        navContainer.classList.toggle('scroll-left', scrollLeft > 2);
        navContainer.classList.toggle('scroll-right', scrollLeft < maxScroll - 2);
      };

      nav.addEventListener('scroll', updateScrollIndicators);
      window.addEventListener('resize', updateScrollIndicators);
      updateScrollIndicators();
    }
  });
</script>

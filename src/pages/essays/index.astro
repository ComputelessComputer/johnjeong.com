---
import { getCollection } from "astro:content";
import Base from "../../layouts/Base.astro";

const essays = await getCollection("essays");
const sortedEssays = essays.sort((a, b) =>
  new Date(b.data.created_at).getTime() - new Date(a.data.created_at).getTime()
);
---

<Base title="Essays - John Jeong">
  <nav style="margin-bottom: 2rem;">
    <a href="/">‚Üê Home</a>
  </nav>

  <h1>Essays</h1>

  <div style="margin: 1rem 0;">
    <button class="lang-btn active" data-lang="all">All</button>
    <button class="lang-btn" data-lang="en">English</button>
    <button class="lang-btn" data-lang="ko">Korean</button>
  </div>

  <ul style="margin-top: 2rem;" id="essays-list">
    {sortedEssays.map((essay) => (
      <li style="margin-bottom: 1rem;" data-lang={essay.data.lang}>
        <a href={`/essays/${essay.id}`}>{essay.data.title}</a>
        {essay.data.lang === "ko" && <span style="color: #999; margin-left: 0.5rem;">üá∞üá∑</span>}
        <br />
        <small style="color: #666;">
          {essay.data.created_at.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })}
        </small>
      </li>
    ))}
  </ul>
</Base>

<style>
  .lang-btn {
    background: none;
    border: 1px solid #ccc;
    padding: 0.25rem 0.75rem;
    margin-right: 0.5rem;
    cursor: pointer;
    border-radius: 4px;
  }
  .lang-btn:hover {
    background: #f0f0f0;
  }
  .lang-btn.active {
    background: #1a1a1a;
    color: white;
    border-color: #1a1a1a;
  }
</style>

<script>
  const buttons = document.querySelectorAll('.lang-btn');
  const items = document.querySelectorAll('#essays-list li');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.getAttribute('data-lang');

      buttons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      items.forEach(item => {
        const itemLang = item.getAttribute('data-lang');
        if (lang === 'all' || itemLang === lang) {
          (item as HTMLElement).style.display = '';
        } else {
          (item as HTMLElement).style.display = 'none';
        }
      });
    });
  });
</script>

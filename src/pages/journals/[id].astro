---
import { getCollection, render } from "astro:content";
import Base from "../../layouts/Base.astro";
import Header from "../../components/Header.astro";
import Giscus from "../../components/Giscus.astro";

export async function getStaticPaths() {
  const journals = await getCollection("journals");
  return journals.map((journal) => ({
    params: { id: journal.id },
    props: { journal },
  }));
}

const { journal } = Astro.props;
const { Content } = await render(journal);

// Parse date from filename (2026_01_02 -> 2026-01-02)
const dateStr = journal.id.replace(/_/g, "-");
const journalDate = new Date(dateStr);
const today = new Date();
today.setHours(0, 0, 0, 0);
journalDate.setHours(0, 0, 0, 0);

const diffTime = today.getTime() - journalDate.getTime();
const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

let relativeDate: string;
if (diffDays === 0) {
  relativeDate = "Today";
} else if (diffDays === 1) {
  relativeDate = "Yesterday";
} else if (diffDays < 7) {
  relativeDate = `${diffDays} days ago`;
} else if (diffDays < 14) {
  const dayName = journalDate.toLocaleDateString("en-US", { weekday: "long" });
  relativeDate = `Last ${dayName}`;
} else {
  relativeDate = journalDate.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}

const fullDate = journalDate.toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Base title={`Journal: ${dateStr}`}>
  <Header currentPage="journals" showGoBack={true} title={relativeDate} subtitle={fullDate} />

  <article>
    <div class="prose">
      <Content />
    </div>
  </article>

  <Giscus category="journals" />
</Base>
